pipeline {
	agent none
	stages {
		stage('job1') {
			agent any
			steps {
				sh '''
				cd $WORKSPACE
				pwd
				ls
				git checkout origin/local1
				python multi_job.py'''
			}
			post{
				success {
					withCredentials([usernamePassword(credentialsId: 'maheedhar_git_token', passwordVariable: 'password', usernameVariable: 'username')]) {
					sh '''
					cd $WORKSPACE
					export https_proxy="http://proxy-chain.intel.com:912"
					git fetch origin
					git checkout main
					git merge origin/local1
					git push https://${username}:${password}@$url
					'''
					}
				}
			}
		}
		stage('job2') {
			agent {
				label 'ubuntu_agent1'
			}
			steps {
				sh '''
				git checkout origin/local2
				python multi_job.py
				'''
			}
			post{
				success {
					withCredentials([usernamePassword(credentialsId: 'maheedhar_git_token', passwordVariable: 'password', usernameVariable: 'username')]) {
					sh '''
					cd $WORKSPACE
					git fetch origin
					git checkout main
					git merge origin/local2
					git push https://${username}:${password}@$url
					'''
					}
				}
			}
		}
		stage('job3') {
			agent {
				docker {
					image 'ubuntu:v1_m'
					}
				}
			steps {
				sh '''
				git checkout origin/local3
				python2 multi_job.py'''
				
			}
			post{
				success {
					withCredentials([usernamePassword(credentialsId: 'maheedhar_git_token', passwordVariable: 'password', usernameVariable: 'username')]) {
					sh '''
					export https_proxy="http://proxy-chain.intel.com:912"
					git config user.name $username
					git config user.email $usermail
					git fetch origin
					git checkout main
					git merge origin/local3
					git push https://${username}:${password}@$url
					'''
					}
				}
			}
		}
	}
}
